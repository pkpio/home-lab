#=================================================
# Contextual lights:
# Scripts to turn lights on smoothly using different
# intial behaviours based on context (such as time)
#=================================================

##################   Turn on smart   ##################
lights_on_smart:
  alias: Lights on with smart transition
  icon: mdi:lightbulb-on
  mode: queued
  fields:
    light:
      description: 'Entity id of the light to interact on'
      example: light.corridor_lights
  sequence:
  - service: light.turn_on
    data_template:
      entity_id: "{{ light }}"
      brightness: >-
        {% if is_state(light, 'on') and state_attr(light, 'brightness') | int > states('input_number.contextual_start_brightness') | int %}
          {{ state_attr(light, 'brightness') | int }}
        {% else %}
          {{ states('input_number.contextual_start_brightness') | int }}
        {% endif %}
      color_temp: "{{ states('input_number.contextual_color_temperature') | int }}"
      transition: 3
  - service: light.turn_on
    data_template:
      entity_id: "{{ light }}"
      brightness: "{{ states('input_number.contextual_final_brightness') | int }}"
      transition: "{{ states('input_number.contextual_transition_time') | int }}"
